
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>evergreen.api &#8212; evergreen.py 3.9.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/readable.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head><body>
  
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">evergreen.api</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for evergreen.api</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- encoding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;API for interacting with evergreen.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>
<span class="kn">from</span> <span class="nn">http</span> <span class="kn">import</span> <span class="n">HTTPStatus</span>
<span class="kn">from</span> <span class="nn">json.decoder</span> <span class="kn">import</span> <span class="n">JSONDecodeError</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">cast</span>

<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">structlog</span>
<span class="kn">from</span> <span class="nn">requests.exceptions</span> <span class="kn">import</span> <span class="n">HTTPError</span>
<span class="kn">from</span> <span class="nn">structlog.stdlib</span> <span class="kn">import</span> <span class="n">LoggerFactory</span>
<span class="kn">from</span> <span class="nn">urllib3.util</span> <span class="kn">import</span> <span class="n">Retry</span>

<span class="kn">from</span> <span class="nn">evergreen.alias</span> <span class="kn">import</span> <span class="n">VariantAlias</span>
<span class="kn">from</span> <span class="nn">evergreen.api_requests</span> <span class="kn">import</span> <span class="n">IssueLinkRequest</span><span class="p">,</span> <span class="n">MetadataLinkRequest</span><span class="p">,</span> <span class="n">SlackAttachment</span>
<span class="kn">from</span> <span class="nn">evergreen.build</span> <span class="kn">import</span> <span class="n">Build</span>
<span class="kn">from</span> <span class="nn">evergreen.commitqueue</span> <span class="kn">import</span> <span class="n">CommitQueue</span>
<span class="kn">from</span> <span class="nn">evergreen.config</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DEFAULT_API_SERVER</span><span class="p">,</span>
    <span class="n">DEFAULT_NETWORK_TIMEOUT_SEC</span><span class="p">,</span>
    <span class="n">EvgAuth</span><span class="p">,</span>
    <span class="n">get_auth_from_config</span><span class="p">,</span>
    <span class="n">read_evergreen_config</span><span class="p">,</span>
    <span class="n">read_evergreen_from_file</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">evergreen.distro</span> <span class="kn">import</span> <span class="n">Distro</span>
<span class="kn">from</span> <span class="nn">evergreen.host</span> <span class="kn">import</span> <span class="n">Host</span>
<span class="kn">from</span> <span class="nn">evergreen.manifest</span> <span class="kn">import</span> <span class="n">Manifest</span>
<span class="kn">from</span> <span class="nn">evergreen.patch</span> <span class="kn">import</span> <span class="n">Patch</span><span class="p">,</span> <span class="n">PatchCreationDetails</span>
<span class="kn">from</span> <span class="nn">evergreen.performance_results</span> <span class="kn">import</span> <span class="n">PerformanceData</span>
<span class="kn">from</span> <span class="nn">evergreen.project</span> <span class="kn">import</span> <span class="n">Project</span>
<span class="kn">from</span> <span class="nn">evergreen.resource_type_permissions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">PermissionableResourceType</span><span class="p">,</span>
    <span class="n">RemovablePermission</span><span class="p">,</span>
    <span class="n">ResourceTypePermissions</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">evergreen.stats</span> <span class="kn">import</span> <span class="n">TaskStats</span><span class="p">,</span> <span class="n">TestStats</span>
<span class="kn">from</span> <span class="nn">evergreen.task</span> <span class="kn">import</span> <span class="n">Task</span>
<span class="kn">from</span> <span class="nn">evergreen.task_annotations</span> <span class="kn">import</span> <span class="n">TaskAnnotation</span>
<span class="kn">from</span> <span class="nn">evergreen.task_reliability</span> <span class="kn">import</span> <span class="n">TaskReliability</span>
<span class="kn">from</span> <span class="nn">evergreen.tst</span> <span class="kn">import</span> <span class="n">Tst</span>
<span class="kn">from</span> <span class="nn">evergreen.users_for_role</span> <span class="kn">import</span> <span class="n">UsersForRole</span>
<span class="kn">from</span> <span class="nn">evergreen.util</span> <span class="kn">import</span> <span class="n">evergreen_input_to_output</span><span class="p">,</span> <span class="n">format_evergreen_date</span><span class="p">,</span> <span class="n">iterate_by_time_window</span>
<span class="kn">from</span> <span class="nn">evergreen.version</span> <span class="kn">import</span> <span class="n">RecentVersions</span><span class="p">,</span> <span class="n">Requester</span><span class="p">,</span> <span class="n">Version</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">urlparse</span> <span class="kn">import</span> <span class="n">urlparse</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span>  <span class="c1"># type: ignore</span>


<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">structlog</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">CACHE_SIZE</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">DEFAULT_LIMIT</span> <span class="o">=</span> <span class="mi">100</span>

<span class="n">DEFAULT_HTTP_RETRY_ATTEMPTS</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">DEFAULT_HTTP_RETRY_BACKOFF_FACTOR</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">DEFAULT_HTTP_RETRY_BACKOFF_MAX_SEC</span> <span class="o">=</span> <span class="mi">120</span>
<span class="n">DEFAULT_HTTP_RETRY_CODES</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="mi">408</span><span class="p">,</span>  <span class="c1"># Request Timeout</span>
        <span class="mi">409</span><span class="p">,</span>  <span class="c1"># Conflict</span>
        <span class="mi">425</span><span class="p">,</span>  <span class="c1"># Too Early</span>
        <span class="mi">429</span><span class="p">,</span>  <span class="c1"># Too Many Requests</span>
        <span class="mi">500</span><span class="p">,</span>  <span class="c1"># Internal Server Error</span>
        <span class="mi">502</span><span class="p">,</span>  <span class="c1"># Bad Gateway</span>
        <span class="mi">503</span><span class="p">,</span>  <span class="c1"># Service Unavailable</span>
        <span class="mi">504</span><span class="p">,</span>  <span class="c1"># Gatway Timeout</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">EVERGREEN_URL_REGEX</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(https?)://evergreen\..*?(?=\n)&quot;</span><span class="p">)</span>
<span class="n">EVERGREEN_PATCH_ID_REGEX</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;=ID : )\w</span><span class="si">{24}</span><span class="s2">&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="EvergreenApi"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi">[docs]</a><span class="k">class</span> <span class="nc">EvergreenApi</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base methods for building API objects.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">api_server</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_API_SERVER</span><span class="p">,</span>
        <span class="n">auth</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EvgAuth</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">log_on_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">use_default_logger_factory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">http_retry</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Retry</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a _BaseEvergreenApi object.</span>

<span class="sd">        :param api_server: URI of Evergreen API server.</span>
<span class="sd">        :param auth: EvgAuth object with auth information.</span>
<span class="sd">        :param timeout: Time (in sec) to wait before considering a call as failed.</span>
<span class="sd">        :param session: Session to use for requests.</span>
<span class="sd">        :param log_on_error: Flag to use for error logs.</span>
<span class="sd">        :param use_default_logger_factory: Indicate if the module should configure the default logger factory.</span>
<span class="sd">        :param http_retry: Optional Retry object that can be used to customize http request retries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_api_server</span> <span class="o">=</span> <span class="n">api_server</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span> <span class="o">=</span> <span class="n">auth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="n">session</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_on_error</span> <span class="o">=</span> <span class="n">log_on_error</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_http_retry</span> <span class="o">=</span> <span class="n">http_retry</span>

        <span class="k">if</span> <span class="n">use_default_logger_factory</span><span class="p">:</span>
            <span class="n">structlog</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">logger_factory</span><span class="o">=</span><span class="n">LoggerFactory</span><span class="p">())</span>

<div class="viewcode-block" id="EvergreenApi.with_session"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.with_session">[docs]</a>    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">with_session</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="s2">&quot;EvergreenApi&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Yield an instance of the API client with a shared session.&quot;&quot;&quot;</span>
        <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_session</span><span class="p">()</span>
        <span class="n">evg_api</span> <span class="o">=</span> <span class="n">EvergreenApi</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_api_server</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_on_error</span>
        <span class="p">)</span>
        <span class="k">yield</span> <span class="n">evg_api</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">session</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the shared session if it exists, else create a new session.</span>

<span class="sd">        :return: Session to query the API with.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_session</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_create_session</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new session to query the API with.&quot;&quot;&quot;</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="n">adapter</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">adapters</span><span class="o">.</span><span class="n">HTTPAdapter</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_http_retry</span><span class="p">)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">urlparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_server</span><span class="p">)</span><span class="o">.</span><span class="n">scheme</span><span class="si">}</span><span class="s2">://&quot;</span><span class="p">,</span> <span class="n">adapter</span><span class="p">)</span>
        <span class="n">auth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span>
        <span class="k">if</span> <span class="n">auth</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;Api-User&quot;</span><span class="p">:</span> <span class="n">auth</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="s2">&quot;Api-Key&quot;</span><span class="p">:</span> <span class="n">auth</span><span class="o">.</span><span class="n">api_key</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">session</span>

    <span class="k">def</span> <span class="nf">_create_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Format a call to a v2 REST API endpoint.</span>

<span class="sd">        :param endpoint: endpoint to call.</span>
<span class="sd">        :return: Full url to get endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_server</span><span class="si">}</span><span class="s2">/rest/v2</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">_create_plugin_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Format the a call to a plugin endpoint.</span>

<span class="sd">        :param endpoint: endpoint to call.</span>
<span class="sd">        :return: Full url to get endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_server</span><span class="si">}</span><span class="s2">/plugin/json</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_log_api_call_time</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">,</span> <span class="n">start_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log how long the api call took.</span>

<span class="sd">        :param response: Response from API.</span>
<span class="sd">        :param start_time: Time the response was started.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">duration</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Request completed.&quot;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Request completed.&quot;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_call_api</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a call to the evergreen api.</span>

<span class="sd">        :param url: Url of call to make.</span>
<span class="sd">        :param params: parameters to pass to api.</span>
<span class="sd">        :param method: HTTP method to make call with.</span>
<span class="sd">        :param data: Extra data to send to the endpoint.</span>
<span class="sd">        :return: response from api server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Request to be sent&quot;</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span>
        <span class="p">)</span>

        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Response received&quot;</span><span class="p">,</span>
            <span class="n">request_url</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
            <span class="n">request_method</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
            <span class="n">request_body</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">,</span>
            <span class="n">response_status_code</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
            <span class="n">response_text</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_api_call_time</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_for_status</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>

    <span class="k">def</span> <span class="nf">_stream_api</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">decode_unicode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">chunk_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">is_binary</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a streaming call based on if artifact is binary or nonbinary.</span>

<span class="sd">        :param url: url to call</span>
<span class="sd">        :param params: url parameters</span>
<span class="sd">        :param decode_unicode: determines if we decode as unicode</span>
<span class="sd">        :param chunk_size: the size of the chunks to be read</span>
<span class="sd">        :param is_binary: is the data being streamed a binary object</span>
<span class="sd">        :return: Iterable over the lines of the returned content.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span><span class="p">)</span> <span class="k">as</span> <span class="n">res</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_api_call_time</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_binary</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">,</span> <span class="n">decode_unicode</span><span class="o">=</span><span class="n">decode_unicode</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">line</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">iter_lines</span><span class="p">(</span><span class="n">decode_unicode</span><span class="o">=</span><span class="n">decode_unicode</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">line</span>

    <span class="k">def</span> <span class="nf">_raise_for_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Raise an exception with the evergreen message if it exists.</span>

<span class="sd">        :param response: response from evergreen api.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">json_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span> <span class="ow">and</span> <span class="s2">&quot;error&quot;</span> <span class="ow">in</span> <span class="n">json_data</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_on_error</span><span class="p">:</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="s2">&quot;Error found in json&quot;</span><span class="p">,</span>
                        <span class="n">request_url</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
                        <span class="n">request_method</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
                        <span class="n">request_body</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">,</span>
                        <span class="n">response_status_code</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
                        <span class="n">response_text</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">raise</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">(</span><span class="n">json_data</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">],</span> <span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">JSONDecodeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_paginate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Paginate until all results are returned and return a list of all JSON results.</span>

<span class="sd">        :param url: url to make request to.</span>
<span class="sd">        :param params: parameters to pass to request.</span>
<span class="sd">        :return: json list of all results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">json_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">while</span> <span class="s2">&quot;next&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">params</span> <span class="ow">and</span> <span class="s2">&quot;limit&quot;</span> <span class="ow">in</span> <span class="n">params</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;limit&quot;</span><span class="p">]:</span>
                <span class="k">break</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="s2">&quot;next&quot;</span><span class="p">][</span><span class="s2">&quot;url&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">():</span>
                <span class="n">json_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">json_data</span>

    <span class="k">def</span> <span class="nf">_lazy_paginate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lazy paginate, the results are returned lazily.</span>

<span class="sd">        :param url: URL to query.</span>
<span class="sd">        :param params: Params to pass to url.</span>
<span class="sd">        :return: A generator to get results from.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">DEFAULT_LIMIT</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="n">next_url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">next_url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
            <span class="n">json_response</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">json_response</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">json_response</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">result</span>
            <span class="k">if</span> <span class="s2">&quot;next&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">next_url</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="s2">&quot;next&quot;</span><span class="p">][</span><span class="s2">&quot;url&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_lazy_paginate_by_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Paginate based on date, the results are returned lazily.</span>

<span class="sd">        :param url: URL to query.</span>
<span class="sd">        :param params: Params to pass to url.</span>
<span class="sd">        :return: A generator to get results from.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">DEFAULT_LIMIT</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">result</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;start_at&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">evergreen_input_to_output</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;create_time&quot;</span><span class="p">])</span>

<div class="viewcode-block" id="EvergreenApi.all_distros"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.all_distros">[docs]</a>    <span class="k">def</span> <span class="nf">all_distros</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Distro</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all distros in evergreen.</span>

<span class="sd">        :return: List of all distros in evergreen.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="s2">&quot;/distros&quot;</span><span class="p">)</span>
        <span class="n">distro_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paginate</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Distro</span><span class="p">(</span><span class="n">distro</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">distro</span> <span class="ow">in</span> <span class="n">distro_list</span><span class="p">]</span>  <span class="c1"># type: ignore[arg-type]</span></div>

<div class="viewcode-block" id="EvergreenApi.all_hosts"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.all_hosts">[docs]</a>    <span class="k">def</span> <span class="nf">all_hosts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Host</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all hosts in evergreen.</span>

<span class="sd">        :param status: Only return hosts with specified status.</span>
<span class="sd">        :return: List of all hosts in evergreen.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">status</span>

        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="s2">&quot;/hosts&quot;</span><span class="p">)</span>
        <span class="n">host_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paginate</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Host</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">host</span> <span class="ow">in</span> <span class="n">host_list</span><span class="p">]</span>  <span class="c1"># type: ignore[arg-type]</span></div>

<div class="viewcode-block" id="EvergreenApi.host_by_id"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.host_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">host_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Host</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get evergreen host by id.</span>

<span class="sd">        :param host_id: host ids, &#39;i-000cba730e92eb85b&#39;</span>
<span class="sd">        :return: host document</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/hosts/</span><span class="si">{</span><span class="n">host_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Host</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_paginate</span><span class="p">(</span><span class="n">url</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span></div>

<div class="viewcode-block" id="EvergreenApi.configure_task"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.configure_task">[docs]</a>    <span class="k">def</span> <span class="nf">configure_task</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">activated</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">priority</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update a task.</span>

<span class="sd">        :param task_id: Id of the task to update</span>
<span class="sd">        :param activated: If specified, will update the task to specified value True or False</span>
<span class="sd">        :param priority: If specified, will update the task&#39;s priority to specified number</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/tasks/</span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">activated</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;activated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">activated</span>
        <span class="k">if</span> <span class="n">priority</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;priority&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">priority</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;PATCH&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="EvergreenApi.restart_task"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.restart_task">[docs]</a>    <span class="k">def</span> <span class="nf">restart_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restart a task.</span>

<span class="sd">        :param task_id: Id of the task to restart</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/tasks/</span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">/restart&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="EvergreenApi.abort_task"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.abort_task">[docs]</a>    <span class="k">def</span> <span class="nf">abort_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Abort a task.</span>

<span class="sd">        :param task_id: Id of the task to abort</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/tasks/</span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">/abort&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="EvergreenApi.all_projects"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.all_projects">[docs]</a>    <span class="k">def</span> <span class="nf">all_projects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_filter_fn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Project</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all projects in evergreen.</span>

<span class="sd">        :param project_filter_fn: function to filter projects, should accept a project_id argument.</span>
<span class="sd">        :return: List of all projects in evergreen.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="s2">&quot;/projects&quot;</span><span class="p">)</span>
        <span class="n">project_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paginate</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">projects</span> <span class="o">=</span> <span class="p">[</span><span class="n">Project</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">project_list</span><span class="p">]</span>  <span class="c1"># type: ignore[arg-type]</span>
        <span class="k">if</span> <span class="n">project_filter_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">project</span> <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">projects</span> <span class="k">if</span> <span class="n">project_filter_fn</span><span class="p">(</span><span class="n">project</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">projects</span></div>

<div class="viewcode-block" id="EvergreenApi.project_by_id"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.project_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">project_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Project</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a project by project_id.</span>

<span class="sd">        :param project_id: Id of project to query.</span>
<span class="sd">        :return: Project specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/projects/</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Project</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_paginate</span><span class="p">(</span><span class="n">url</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span></div>

<div class="viewcode-block" id="EvergreenApi.recent_versions_by_project"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.recent_versions_by_project">[docs]</a>    <span class="k">def</span> <span class="nf">recent_versions_by_project</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RecentVersions</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get recent versions created in specified project.</span>

<span class="sd">        :param project_id: Id of project to query.</span>
<span class="sd">        :param params: parameters to pass to endpoint.</span>
<span class="sd">        :return: List of recent versions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/projects/</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">/recent_versions&quot;</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">RecentVersions</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span> <span class="bp">self</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span></div>

<div class="viewcode-block" id="EvergreenApi.send_slack_message"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.send_slack_message">[docs]</a>    <span class="k">def</span> <span class="nf">send_slack_message</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">attachments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">SlackAttachment</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send a Slack message to a user or channel in Slack.</span>

<span class="sd">        :param target: The slack name of the user or channel to send the message to.</span>
<span class="sd">        :param msg: The slack message to send.</span>
<span class="sd">        :param attachments: What additional data to send to the specified target in Slack.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="s2">&quot;/notifications/slack&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="n">target</span><span class="p">,</span>
            <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">attachments</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;attachments&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">attachment</span><span class="o">.</span><span class="n">dict</span><span class="p">(</span><span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">attachment</span> <span class="ow">in</span> <span class="n">attachments</span>
            <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="EvergreenApi.send_email"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.send_email">[docs]</a>    <span class="k">def</span> <span class="nf">send_email</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">recipients</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">sender</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">subject</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">body</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">is_plain_text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">headers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send an email to a user.</span>

<span class="sd">        :param recipients: Who to send the email to.</span>
<span class="sd">        :param sender: Who the email should be sent on behalf of.</span>
<span class="sd">        :param subject: The subject of the email to send.</span>
<span class="sd">        :param body: What should be in the body of the email.</span>
<span class="sd">        :param is_plain_text: If the email is in plain text or not. If true, will be text/plain. text/html otherwise.</span>
<span class="sd">        :param headers: What email headers to attach.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="s2">&quot;/notifications/email&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;recipients&quot;</span><span class="p">:</span> <span class="n">recipients</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">sender</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sender&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sender</span>
        <span class="k">if</span> <span class="n">subject</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>
        <span class="k">if</span> <span class="n">body</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">body</span>
        <span class="k">if</span> <span class="n">is_plain_text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;is_plain_text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_plain_text</span>
        <span class="k">if</span> <span class="n">headers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;headers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">headers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="EvergreenApi.alias_for_version"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.alias_for_version">[docs]</a>    <span class="k">def</span> <span class="nf">alias_for_version</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">version_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">alias</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">include_deps</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">VariantAlias</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the tasks and variants that an alias would select for an evergreen version.</span>

<span class="sd">        :param version_id: Evergreen version to query against.</span>
<span class="sd">        :param alias: Alias to query.</span>
<span class="sd">        :param include_deps: If true, will also select tasks that are dependencies.</span>
<span class="sd">        :return: List of Variant alias details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">version_id</span><span class="p">,</span> <span class="s2">&quot;alias&quot;</span><span class="p">:</span> <span class="n">alias</span><span class="p">,</span> <span class="s2">&quot;include_deps&quot;</span><span class="p">:</span> <span class="n">include_deps</span><span class="p">}</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="s2">&quot;/projects/test_alias&quot;</span><span class="p">)</span>
        <span class="n">variant_alias_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paginate</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">VariantAlias</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">variant_alias</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">variant_alias</span> <span class="ow">in</span> <span class="n">variant_alias_list</span>
        <span class="p">]</span></div>

<div class="viewcode-block" id="EvergreenApi.versions_by_project"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.versions_by_project">[docs]</a>    <span class="k">def</span> <span class="nf">versions_by_project</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">requester</span><span class="p">:</span> <span class="n">Requester</span> <span class="o">=</span> <span class="n">Requester</span><span class="o">.</span><span class="n">GITTER_REQUEST</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">revision_start</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">revision_end</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Version</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the versions created in the specified project.</span>

<span class="sd">        :param project_id: Id of project to query.</span>
<span class="sd">        :param requester: Type of versions to query.</span>
<span class="sd">        :param start: Optional. The revision order number to start after, for pagination.</span>
<span class="sd">        :param limit: Optional. The number of versions to be returned per page of pagination.</span>
<span class="sd">        :param revision_start: Optional. The version order number to start at, for pagination.</span>
<span class="sd">        :param revision_end: Optional. The version order number to end at, for pagination.</span>
<span class="sd">        :return: Generator of versions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/projects/</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">/versions&quot;</span><span class="p">)</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;requester&quot;</span><span class="p">:</span> <span class="n">requester</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;limit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">limit</span>
        <span class="k">if</span> <span class="n">revision_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;revision_start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">revision_start</span>
        <span class="k">if</span> <span class="n">revision_end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;revision_end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">revision_end</span>
        <span class="n">version_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy_paginate</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">Version</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">version_list</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span></div>

<div class="viewcode-block" id="EvergreenApi.versions_by_project_time_window"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.versions_by_project_time_window">[docs]</a>    <span class="k">def</span> <span class="nf">versions_by_project_time_window</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">before</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
        <span class="n">after</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
        <span class="n">requester</span><span class="p">:</span> <span class="n">Requester</span> <span class="o">=</span> <span class="n">Requester</span><span class="o">.</span><span class="n">GITTER_REQUEST</span><span class="p">,</span>
        <span class="n">time_attr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;create_time&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Version</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an iterator over the patches for the given time window.</span>

<span class="sd">        :param project_id: Id of project to query.</span>
<span class="sd">        :param requester: Type of version to query</span>
<span class="sd">        :param before: Return versions earlier than this timestamp.</span>
<span class="sd">        :param after: Return versions later than this timestamp.</span>
<span class="sd">        :param time_attr: Attributes to use to window timestamps.</span>
<span class="sd">        :return: Iterator for the given time window.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">iterate_by_time_window</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">versions_by_project</span><span class="p">(</span><span class="n">project_id</span><span class="p">,</span> <span class="n">requester</span><span class="p">),</span> <span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">,</span> <span class="n">time_attr</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="EvergreenApi.patches_by_project"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.patches_by_project">[docs]</a>    <span class="k">def</span> <span class="nf">patches_by_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Patch</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of patches for the specified project.</span>

<span class="sd">        :param project_id: Id of project to query.</span>
<span class="sd">        :param params: parameters to pass to endpoint.</span>
<span class="sd">        :return: List of recent patches.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/projects/</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">/patches&quot;</span><span class="p">)</span>
        <span class="n">patches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy_paginate_by_date</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">Patch</span><span class="p">(</span><span class="n">patch</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="n">patches</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span></div>

<div class="viewcode-block" id="EvergreenApi.update_patch_status"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.update_patch_status">[docs]</a>    <span class="k">def</span> <span class="nf">update_patch_status</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">patch_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">activated</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">priority</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update a patch and set its status.</span>

<span class="sd">        :param patch_id: Id of the patch to update</span>
<span class="sd">        :param activated: If specified, will update the patch to specified value True or False</span>
<span class="sd">        :param priority: If specified, will update the patch&#39;s priority to specified number</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/patches/</span><span class="si">{</span><span class="n">patch_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">activated</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;activated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">activated</span>
        <span class="k">if</span> <span class="n">priority</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;priority&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">priority</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;PATCH&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="EvergreenApi.configure_patch"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.configure_patch">[docs]</a>    <span class="k">def</span> <span class="nf">configure_patch</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">patch_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">variants</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]],</span>
        <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update a patch.</span>

<span class="sd">        :param patch_id: Id of the patch to update</span>
<span class="sd">        :param variants: list of objects with keys &quot;id&quot; who&#39;s value is the variant ID, and key &quot;tasks&quot;</span>
<span class="sd">            with value of a list of task names to configure for specified variant. See the documentation for more details</span>
<span class="sd">            https://github.com/evergreen-ci/evergreen/wiki/REST-V2-Usage#configureschedule-a-patch</span>
<span class="sd">        :param description: If specified, will update the patch&#39;s description with the string provided</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/patches/</span><span class="si">{</span><span class="n">patch_id</span><span class="si">}</span><span class="s2">/configure&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">variants</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;variants&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">variants</span>
        <span class="k">if</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">description</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="EvergreenApi.patches_by_project_time_window"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.patches_by_project_time_window">[docs]</a>    <span class="k">def</span> <span class="nf">patches_by_project_time_window</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">before</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
        <span class="n">after</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">time_attr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;create_time&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Patch</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an iterator over the patches for the given time window.</span>

<span class="sd">        :param project_id: Id of project to query.</span>
<span class="sd">        :param params: Parameters to pass to endpoint.</span>
<span class="sd">        :param before: Return patches earlier than this timestamp</span>
<span class="sd">        :param after: Return patches later than this timestamp.</span>
<span class="sd">        :param time_attr: Attributes to use to window timestamps.</span>
<span class="sd">        :return: Iterator for the given time window.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">iterate_by_time_window</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">patches_by_project</span><span class="p">(</span><span class="n">project_id</span><span class="p">,</span> <span class="n">params</span><span class="p">),</span> <span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">,</span> <span class="n">time_attr</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="EvergreenApi.patches_by_user"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.patches_by_user">[docs]</a>    <span class="k">def</span> <span class="nf">patches_by_user</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start_at</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Patch</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an iterable of recent patches by the given user.</span>

<span class="sd">        :param user_id: Id of user to query.</span>
<span class="sd">        :param start_at: If specified, query starting at the given date.</span>
<span class="sd">        :param limit: If specified, limit the output per page.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">start_at</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;start_at&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_at</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;limit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">limit</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/users/</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">/patches&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">Patch</span><span class="p">(</span><span class="n">patch</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy_paginate</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span></div>

<div class="viewcode-block" id="EvergreenApi.commit_queue_for_project"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.commit_queue_for_project">[docs]</a>    <span class="k">def</span> <span class="nf">commit_queue_for_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommitQueue</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the current commit queue for the specified project.</span>

<span class="sd">        :param project_id: Id of project to query.</span>
<span class="sd">        :return: Current commit queue for project.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/commit_queue/</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">CommitQueue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_paginate</span><span class="p">(</span><span class="n">url</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span></div>

<div class="viewcode-block" id="EvergreenApi.test_stats_by_project"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.test_stats_by_project">[docs]</a>    <span class="k">def</span> <span class="nf">test_stats_by_project</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">after_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
        <span class="n">before_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
        <span class="n">group_num_days</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">requesters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Requester</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tests</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tasks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">variants</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">distros</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">group_by</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TestStats</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a patch by patch id.</span>

<span class="sd">        :param project_id: Id of patch to query for.</span>
<span class="sd">        :param after_date: Collect stats after this date.</span>
<span class="sd">        :param before_date: Collect stats before this date.</span>
<span class="sd">        :param group_num_days: Aggregate statistics to this size.</span>
<span class="sd">        :param requesters: Filter by requestors (mainline, patch, trigger, or adhoc).</span>
<span class="sd">        :param tests: Only include specified tests.</span>
<span class="sd">        :param tasks: Only include specified tasks.</span>
<span class="sd">        :param variants: Only include specified variants.</span>
<span class="sd">        :param distros: Only include specified distros.</span>
<span class="sd">        :param group_by: How to group results (test_task_variant, test_task, or test)</span>
<span class="sd">        :param sort: How to sort results (earliest or latest).</span>
<span class="sd">        :return: Patch queried for.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;after_date&quot;</span><span class="p">:</span> <span class="n">format_evergreen_date</span><span class="p">(</span><span class="n">after_date</span><span class="p">),</span>
            <span class="s2">&quot;before_date&quot;</span><span class="p">:</span> <span class="n">format_evergreen_date</span><span class="p">(</span><span class="n">before_date</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">group_num_days</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;group_num_days&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_num_days</span>
        <span class="k">if</span> <span class="n">requesters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;requesters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">requesters</span><span class="o">.</span><span class="n">stats_value</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">tests</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;tests&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tests</span>
        <span class="k">if</span> <span class="n">tasks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;tasks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tasks</span>
        <span class="k">if</span> <span class="n">variants</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;variants&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">variants</span>
        <span class="k">if</span> <span class="n">distros</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;distros&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">distros</span>
        <span class="k">if</span> <span class="n">group_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;group_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_by</span>
        <span class="k">if</span> <span class="n">sort</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;sort&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sort</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/projects/</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">/test_stats&quot;</span><span class="p">)</span>
        <span class="n">test_stats_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paginate</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">TestStats</span><span class="p">(</span><span class="n">test_stat</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">test_stat</span> <span class="ow">in</span> <span class="n">test_stats_list</span><span class="p">]</span>  <span class="c1"># type: ignore[arg-type]</span></div>

<div class="viewcode-block" id="EvergreenApi.tasks_by_project"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.tasks_by_project">[docs]</a>    <span class="k">def</span> <span class="nf">tasks_by_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">statuses</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Task</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all the tasks for a project.</span>

<span class="sd">        :param project_id: The project&#39;s id.</span>
<span class="sd">        :param statuses: the types of statuses to get tasks for.</span>
<span class="sd">        :return: The list of matching tasks.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/projects/</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">/versions/tasks&quot;</span><span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">statuses</span><span class="p">}</span> <span class="k">if</span> <span class="n">statuses</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Task</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">json</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paginate</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)]</span>  <span class="c1"># type: ignore[arg-type]</span></div>

<div class="viewcode-block" id="EvergreenApi.tasks_by_project_and_commit"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.tasks_by_project_and_commit">[docs]</a>    <span class="k">def</span> <span class="nf">tasks_by_project_and_commit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">commit_hash</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Task</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all the tasks for a revision in specified project.</span>

<span class="sd">        :param project_id: Project id associated with the revision</span>
<span class="sd">        :param commit_hash: Commit to get tasks for</span>
<span class="sd">        :param params: Dictionary of parameters to pass to query.</span>
<span class="sd">        :return: The list of matching tasks.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/projects/</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">/revisions/</span><span class="si">{</span><span class="n">commit_hash</span><span class="si">}</span><span class="s2">/tasks&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Task</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">json</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paginate</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)]</span>  <span class="c1"># type: ignore[arg-type]</span></div>

<div class="viewcode-block" id="EvergreenApi.tasks_by_project_and_name"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.tasks_by_project_and_name">[docs]</a>    <span class="k">def</span> <span class="nf">tasks_by_project_and_name</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">task_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">build_variant</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_versions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">start_at</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Task</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all the tasks for a project by task name.</span>

<span class="sd">        :param project_id: Id of project to query.</span>
<span class="sd">        :param task_name: Name of task to query for.</span>
<span class="sd">        :param build_variant: Only include tasks that have run on this build variant.</span>
<span class="sd">        :param num_versions: The number of latest versions to be searched. Defaults to 20.</span>
<span class="sd">        :param start_at: The version order number to start returning results after.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">build_variant</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;build_variant&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">build_variant</span>
        <span class="k">if</span> <span class="n">num_versions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;num_versions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_versions</span>
        <span class="k">if</span> <span class="n">start_at</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;start_at&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_at</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/projects/</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">/tasks/</span><span class="si">{</span><span class="n">task_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">Task</span><span class="p">(</span><span class="n">task_json</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">task_json</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="p">]</span></div>

<div class="viewcode-block" id="EvergreenApi.task_stats_by_project"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.task_stats_by_project">[docs]</a>    <span class="k">def</span> <span class="nf">task_stats_by_project</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">after_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
        <span class="n">before_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
        <span class="n">group_num_days</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">requesters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Requester</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tasks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">variants</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">distros</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">group_by</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TaskStats</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get task stats by project id.</span>

<span class="sd">        :param project_id: Id of patch to query for.</span>
<span class="sd">        :param after_date: Collect stats after this date.</span>
<span class="sd">        :param before_date: Collect stats before this date.</span>
<span class="sd">        :param group_num_days: Aggregate statistics to this size.</span>
<span class="sd">        :param requesters: Filter by requestors (mainline, patch, trigger, or adhoc).</span>
<span class="sd">        :param tasks: Only include specified tasks.</span>
<span class="sd">        :param variants: Only include specified variants.</span>
<span class="sd">        :param distros: Only include specified distros.</span>
<span class="sd">        :param group_by: How to group results (test_task_variant, test_task, or test)</span>
<span class="sd">        :param sort: How to sort results (earliest or latest).</span>
<span class="sd">        :return: Patch queried for.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;after_date&quot;</span><span class="p">:</span> <span class="n">format_evergreen_date</span><span class="p">(</span><span class="n">after_date</span><span class="p">),</span>
            <span class="s2">&quot;before_date&quot;</span><span class="p">:</span> <span class="n">format_evergreen_date</span><span class="p">(</span><span class="n">before_date</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">group_num_days</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;group_num_days&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_num_days</span>
        <span class="k">if</span> <span class="n">requesters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;requesters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">requesters</span><span class="o">.</span><span class="n">stats_value</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">tasks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;tasks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tasks</span>
        <span class="k">if</span> <span class="n">variants</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;variants&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">variants</span>
        <span class="k">if</span> <span class="n">distros</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;distros&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">distros</span>
        <span class="k">if</span> <span class="n">group_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;group_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_by</span>
        <span class="k">if</span> <span class="n">sort</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;sort&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sort</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/projects/</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">/task_stats&quot;</span><span class="p">)</span>
        <span class="n">task_stats_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paginate</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">TaskStats</span><span class="p">(</span><span class="n">task_stat</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">task_stat</span> <span class="ow">in</span> <span class="n">task_stats_list</span><span class="p">]</span>  <span class="c1"># type: ignore[arg-type]</span></div>

<div class="viewcode-block" id="EvergreenApi.task_reliability_by_project"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.task_reliability_by_project">[docs]</a>    <span class="k">def</span> <span class="nf">task_reliability_by_project</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">after_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">before_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">group_num_days</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">requesters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Requester</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tasks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">variants</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">distros</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">group_by</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TaskReliability</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get task reliability scores.</span>

<span class="sd">        :param project_id: Id of patch to query for.</span>
<span class="sd">        :param after_date: Collect stats after this date.</span>
<span class="sd">        :param before_date: Collect stats before this date, defaults to nothing.</span>
<span class="sd">        :param group_num_days: Aggregate statistics to this size.</span>
<span class="sd">        :param requesters: Filter by requesters (mainline, patch, trigger, or adhoc).</span>
<span class="sd">        :param tasks: Only include specified tasks.</span>
<span class="sd">        :param variants: Only include specified variants.</span>
<span class="sd">        :param distros: Only include specified distros.</span>
<span class="sd">        :param group_by: How to group results (test_task_variant, test_task, or test)</span>
<span class="sd">        :param sort: How to sort results (earliest or latest).</span>
<span class="sd">        :return: Patch queried for.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">after_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;after_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">format_evergreen_date</span><span class="p">(</span><span class="n">after_date</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">before_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;before_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">format_evergreen_date</span><span class="p">(</span><span class="n">before_date</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">group_num_days</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;group_num_days&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_num_days</span>
        <span class="k">if</span> <span class="n">requesters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;requesters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">requesters</span><span class="o">.</span><span class="n">stats_value</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">tasks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;tasks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tasks</span>
        <span class="k">if</span> <span class="n">variants</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;variants&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">variants</span>
        <span class="k">if</span> <span class="n">distros</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;distros&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">distros</span>
        <span class="k">if</span> <span class="n">group_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;group_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_by</span>
        <span class="k">if</span> <span class="n">sort</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;sort&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sort</span>

        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/projects/</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">/task_reliability&quot;</span><span class="p">)</span>
        <span class="n">task_reliability_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paginate</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">TaskReliability</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">task_reliability</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">task_reliability</span> <span class="ow">in</span> <span class="n">task_reliability_scores</span>  <span class="c1"># type: ignore[arg-type]</span>
        <span class="p">]</span></div>

<div class="viewcode-block" id="EvergreenApi.build_by_id"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.build_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">build_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">build_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Build</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a build by id.</span>

<span class="sd">        :param build_id: build id to query.</span>
<span class="sd">        :return: Build queried for.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/builds/</span><span class="si">{</span><span class="n">build_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Build</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_paginate</span><span class="p">(</span><span class="n">url</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span></div>

<div class="viewcode-block" id="EvergreenApi.tasks_by_build"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.tasks_by_build">[docs]</a>    <span class="k">def</span> <span class="nf">tasks_by_build</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">build_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fetch_all_executions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Task</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all tasks for a given build.</span>

<span class="sd">        :param build_id: build_id to query.</span>
<span class="sd">        :param fetch_all_executions: Fetch all executions for a given task.</span>
<span class="sd">        :return: List of tasks for the specified build.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">fetch_all_executions</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;fetch_all_executions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/builds/</span><span class="si">{</span><span class="n">build_id</span><span class="si">}</span><span class="s2">/tasks&quot;</span><span class="p">)</span>
        <span class="n">task_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paginate</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Task</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">task_list</span><span class="p">]</span>  <span class="c1"># type: ignore[arg-type]</span></div>

<div class="viewcode-block" id="EvergreenApi.version_by_id"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.version_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">version_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Version</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get version by version id.</span>

<span class="sd">        :param version_id: Id of version to query.</span>
<span class="sd">        :return: Version queried for.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/versions/</span><span class="si">{</span><span class="n">version_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Version</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_paginate</span><span class="p">(</span><span class="n">url</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span></div>

<div class="viewcode-block" id="EvergreenApi.builds_by_version"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.builds_by_version">[docs]</a>    <span class="k">def</span> <span class="nf">builds_by_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Build</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all builds for a given Evergreen version_id.</span>

<span class="sd">        :param version_id: Version Id to query for.</span>
<span class="sd">        :param params: Dictionary of parameters to pass to query.</span>
<span class="sd">        :return: List of builds for the specified version.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/versions/</span><span class="si">{</span><span class="n">version_id</span><span class="si">}</span><span class="s2">/builds&quot;</span><span class="p">)</span>
        <span class="n">build_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paginate</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Build</span><span class="p">(</span><span class="n">build</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">build</span> <span class="ow">in</span> <span class="n">build_list</span><span class="p">]</span>  <span class="c1"># type: ignore[arg-type]</span></div>

<div class="viewcode-block" id="EvergreenApi.patch_by_id"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.patch_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">patch_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patch_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Patch</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a patch by patch id.</span>

<span class="sd">        :param patch_id: Id of patch to query for.</span>
<span class="sd">        :param params: Parameters to pass to endpoint.</span>
<span class="sd">        :return: Patch queried for.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/patches/</span><span class="si">{</span><span class="n">patch_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span> <span class="bp">self</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span></div>

<div class="viewcode-block" id="EvergreenApi.get_patch_diff"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.get_patch_diff">[docs]</a>    <span class="k">def</span> <span class="nf">get_patch_diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patch_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">module</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the diff for a given patch.</span>

<span class="sd">        :param patch_id: The id of the patch to request the diff for.</span>
<span class="sd">        :param module: The module to get the diff for. Defaults to an empty string.</span>
<span class="sd">        :return: The diff of the patch represented as plain text.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;module&quot;</span><span class="p">:</span> <span class="n">module</span><span class="p">}</span> <span class="k">if</span> <span class="n">module</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/patches/</span><span class="si">{</span><span class="n">patch_id</span><span class="si">}</span><span class="s2">/raw&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span></div>

    <span class="k">def</span> <span class="nf">_execute_patch_file_command</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">author</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PatchCreationDetails</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute a patch file command.</span>

<span class="sd">        :param command: The command</span>
<span class="sd">        :param author: An author to attribute the patch to.</span>
<span class="sd">        :raises Exception: Exception if command has unexpected output</span>
<span class="sd">        :return: The patch creation details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">author</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2"> --author </span><span class="si">{</span><span class="n">author</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="p">:</span>
            <span class="c1"># patch-file returns on stderr, but patch returns on stdout,</span>
            <span class="c1"># so if stderr is empty, check stdout</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>

        <span class="n">url_match</span> <span class="o">=</span> <span class="n">EVERGREEN_URL_REGEX</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="n">id_match</span> <span class="o">=</span> <span class="n">EVERGREEN_PATCH_ID_REGEX</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">url_match</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">id_match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to parse URL or ID from command output: </span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">. </span><span class="se">\n</span><span class="s2">Executed command: </span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">PatchCreationDetails</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="nb">id</span><span class="o">=</span><span class="n">id_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

<div class="viewcode-block" id="EvergreenApi.patch_from_diff"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.patch_from_diff">[docs]</a>    <span class="k">def</span> <span class="nf">patch_from_diff</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">diff_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">base</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">task</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">project</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">variant</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">author</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PatchCreationDetails</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start a patch build based on a patch.</span>

<span class="sd">        :param diff_file_path: The path to the diff.</span>
<span class="sd">        :param params: The params to pass to the build.</span>
<span class="sd">        :param base: The build&#39;s base commit.</span>
<span class="sd">        :param task: The task(s) to run.</span>
<span class="sd">        :param project: The project to start the build for.</span>
<span class="sd">        :param description: A description of the build.</span>
<span class="sd">        :param variant: The variant(s) to build against.</span>
<span class="sd">        :param author: The author to attribute for the build.</span>
<span class="sd">        :raises Exception: If a build URL is not produced we raise an exception with the output included.</span>
<span class="sd">        :return: The patch creation details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">unpacked_params</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;--param &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;&quot;</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;evergreen patch-file --diff-file </span><span class="si">{</span><span class="n">diff_file_path</span><span class="si">}</span><span class="s2"> --description &#39;</span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2">&#39; --base </span><span class="si">{</span><span class="n">base</span><span class="si">}</span><span class="s2"> --tasks </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2"> --variants </span><span class="si">{</span><span class="n">variant</span><span class="si">}</span><span class="s2"> --project </span><span class="si">{</span><span class="n">project</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">unpacked_params</span><span class="si">}</span><span class="s2"> -y -f&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_patch_file_command</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">author</span><span class="p">)</span></div>

<div class="viewcode-block" id="EvergreenApi.patch_from_patch_id"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.patch_from_patch_id">[docs]</a>    <span class="k">def</span> <span class="nf">patch_from_patch_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">patch_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">task</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">project</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">variant</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">author</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PatchCreationDetails</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start a patch build based on a diff.</span>

<span class="sd">        :param patch_id: The patch_id to base this build on.</span>
<span class="sd">        :param params: The params to pass to the build.</span>
<span class="sd">        :param task: The task(s) to run.</span>
<span class="sd">        :param project: The project to start the build for.</span>
<span class="sd">        :param description: A description of the build.</span>
<span class="sd">        :param variant: The variant(s) to build against.</span>
<span class="sd">        :param author: The author to attribute for the build.</span>
<span class="sd">        :raises Exception: If a build URL is not produced we raise an exception with the output included.</span>
<span class="sd">        :return: The patch creation details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">unpacked_params</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;--param &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;&quot;</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;evergreen patch-file --diff-patchId </span><span class="si">{</span><span class="n">patch_id</span><span class="si">}</span><span class="s2"> --description &#39;</span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2">&#39; --tasks </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2"> --variants </span><span class="si">{</span><span class="n">variant</span><span class="si">}</span><span class="s2"> --project </span><span class="si">{</span><span class="n">project</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">unpacked_params</span><span class="si">}</span><span class="s2"> -y -f&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_patch_file_command</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">author</span><span class="p">)</span></div>

<div class="viewcode-block" id="EvergreenApi.repeat_patch"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.repeat_patch">[docs]</a>    <span class="k">def</span> <span class="nf">repeat_patch</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">patch_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">project</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">author</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PatchCreationDetails</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start a patch build based on a diff.</span>

<span class="sd">        :param patch_id: The patch_id whose tasks should be repeated.</span>
<span class="sd">        :param params: The params to pass to the build.</span>
<span class="sd">        :param project: The project to start the build for.</span>
<span class="sd">        :param description: A description of the build.</span>
<span class="sd">        :param author: The author to attribute for the build.</span>
<span class="sd">        :raises Exception: If a build URL is not produced we raise an exception with the output included.</span>
<span class="sd">        :return: The patch creation details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">unpacked_params</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;--param &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;&quot;</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;evergreen patch-file --diff-patchId </span><span class="si">{</span><span class="n">patch_id</span><span class="si">}</span><span class="s2"> --repeat-patch </span><span class="si">{</span><span class="n">patch_id</span><span class="si">}</span><span class="s2"> --description &#39;</span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2">&#39; --project </span><span class="si">{</span><span class="n">project</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">unpacked_params</span><span class="si">}</span><span class="s2"> -y -f&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_patch_file_command</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">author</span><span class="p">)</span></div>

<div class="viewcode-block" id="EvergreenApi.task_by_id"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.task_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">task_by_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">fetch_all_executions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">execution</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Task</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a task by task_id.</span>

<span class="sd">        :param task_id: Id of task to query for.</span>
<span class="sd">        :param execution: Will query for a specific task execution</span>
<span class="sd">        :param fetch_all_executions: Should all executions of the task be fetched.</span>
<span class="sd">        :return: Task queried for.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">execution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;execution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">execution</span>
        <span class="k">if</span> <span class="n">fetch_all_executions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;fetch_all_executions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fetch_all_executions</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/tasks/</span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span> <span class="bp">self</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span></div>

<div class="viewcode-block" id="EvergreenApi.tests_by_task"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.tests_by_task">[docs]</a>    <span class="k">def</span> <span class="nf">tests_by_task</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">execution</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tst</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all tests for a given task.</span>

<span class="sd">        :param task_id: Id of task to query for.</span>
<span class="sd">        :param status: Limit results to given status.</span>
<span class="sd">        :param execution: Retrieve the specified task execution (defaults to 0).</span>
<span class="sd">        :return: List of tests for the specified task.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">status</span>
        <span class="k">if</span> <span class="n">execution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;execution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">execution</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/tasks/</span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">/tests&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Tst</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paginate</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)]</span>  <span class="c1"># type: ignore[arg-type]</span></div>

<div class="viewcode-block" id="EvergreenApi.single_test_by_task_and_test_file"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.single_test_by_task_and_test_file">[docs]</a>    <span class="k">def</span> <span class="nf">single_test_by_task_and_test_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">test_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tst</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a test for a given task.</span>

<span class="sd">        :param task_id: Id of task to query for.</span>
<span class="sd">        :param test_file: the name of the test_file of the test.</span>
<span class="sd">        :return: the test for the specified task.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/tasks/</span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">/tests&quot;</span><span class="p">)</span>
        <span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;test_name&quot;</span><span class="p">:</span> <span class="n">test_file</span><span class="p">}</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Tst</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">param</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()]</span></div>

<div class="viewcode-block" id="EvergreenApi.num_of_tests_by_task"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.num_of_tests_by_task">[docs]</a>    <span class="k">def</span> <span class="nf">num_of_tests_by_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the number of tests that ran as part of the given task.</span>

<span class="sd">        :param task_id: Id of task to query for.</span>
<span class="sd">        :return: Number of tests for the specified task.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/tasks/</span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">/tests/count&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span></div>

<div class="viewcode-block" id="EvergreenApi.manifest_for_task"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.manifest_for_task">[docs]</a>    <span class="k">def</span> <span class="nf">manifest_for_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Manifest</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the manifest for the given task.</span>

<span class="sd">        :param task_id: Task Id fo query.</span>
<span class="sd">        :return: Manifest for the given task.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/tasks/</span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">/manifest&quot;</span><span class="p">)</span>

        <span class="n">manifest</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Manifest</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">manifest</span> <span class="o">=</span> <span class="n">Manifest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span> <span class="bp">self</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
        <span class="k">except</span> <span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">NOT_FOUND</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span>

        <span class="k">return</span> <span class="n">manifest</span></div>

<div class="viewcode-block" id="EvergreenApi.get_task_annotation"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.get_task_annotation">[docs]</a>    <span class="k">def</span> <span class="nf">get_task_annotation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">execution</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fetch_all_executions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TaskAnnotation</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the task annotations for the given task.</span>

<span class="sd">        :param task_id: Id of task to query.</span>
<span class="sd">        :param execution: Execution number of task to query (defaults to latest).</span>
<span class="sd">        :param fetch_all_executions: Get annotations for all executions of this task.</span>
<span class="sd">        :return: The task annotations for the given task, if any exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">execution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fetch_all_executions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;execution&#39; and &#39;fetch_all_executions&#39; are mutually-exclusive&quot;</span><span class="p">)</span>

        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/tasks/</span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">/annotations&quot;</span><span class="p">)</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">execution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;execution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">execution</span>
        <span class="k">if</span> <span class="n">fetch_all_executions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;fetch_all_executions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fetch_all_executions</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;null&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">TaskAnnotation</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">annotation</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()]</span></div>

<div class="viewcode-block" id="EvergreenApi.file_ticket_for_task"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.file_ticket_for_task">[docs]</a>    <span class="k">def</span> <span class="nf">file_ticket_for_task</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">execution</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ticket_link</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ticket_key</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update an Evergreen task with information about a ticket created from it.</span>

<span class="sd">        :param task_id: The id of the task to update.</span>
<span class="sd">        :param execution: The execution of the task to update.</span>
<span class="sd">        :param ticket_link: The url link to the created ticket.</span>
<span class="sd">        :param ticket_key: The key of the created ticket.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/tasks/</span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">/created_ticket&quot;</span><span class="p">)</span>
        <span class="n">request</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">ticket_link</span><span class="p">,</span> <span class="s2">&quot;issue_key&quot;</span><span class="p">:</span> <span class="n">ticket_key</span><span class="p">}</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;execution&quot;</span><span class="p">:</span> <span class="n">execution</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">request</span><span class="p">),</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span></div>

<div class="viewcode-block" id="EvergreenApi.annotate_task"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.annotate_task">[docs]</a>    <span class="k">def</span> <span class="nf">annotate_task</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">execution</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">issues</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">IssueLinkRequest</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">suspected_issues</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">IssueLinkRequest</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata_links</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">MetadataLinkRequest</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Annotate the specified task.</span>

<span class="sd">        :param task_id: ID of task to annotate.</span>
<span class="sd">        :param execution: Execution number of task to annotate (default to latest).</span>
<span class="sd">        :param message: Message to add to the annotations.</span>
<span class="sd">        :param issues: Issues to attach to the annotation.</span>
<span class="sd">        :param suspected_issues: Suspected issues to add to the annotation.</span>
<span class="sd">        :param metadata: Extra metadata to add to the issue.</span>
<span class="sd">        :param metadata_links: Metadata link to add to the annotation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/tasks/</span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">/annotation&quot;</span><span class="p">)</span>
        <span class="n">request</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;task_id&quot;</span><span class="p">:</span> <span class="n">task_id</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">execution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;task_execution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">execution</span>

        <span class="k">if</span> <span class="n">message</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;note&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">issues</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">issue</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">issue</span> <span class="ow">in</span> <span class="n">issues</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">suspected_issues</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;suspected_issues&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">issue</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">issue</span> <span class="ow">in</span> <span class="n">suspected_issues</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span>

        <span class="k">if</span> <span class="n">metadata_links</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request</span><span class="p">[</span><span class="s2">&quot;metadata_links&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">link</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">metadata_links</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">request</span><span class="p">))</span></div>

<div class="viewcode-block" id="EvergreenApi.performance_results_by_task"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.performance_results_by_task">[docs]</a>    <span class="k">def</span> <span class="nf">performance_results_by_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PerformanceData</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the &#39;perf.json&#39; performance results for a given task_id.</span>

<span class="sd">        :param task_id: Id of task to query for.</span>
<span class="sd">        :return: Contents of &#39;perf.json&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_plugin_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/task/</span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">/perf&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">PerformanceData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_paginate</span><span class="p">(</span><span class="n">url</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span></div>

<div class="viewcode-block" id="EvergreenApi.performance_results_by_task_name"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.performance_results_by_task_name">[docs]</a>    <span class="k">def</span> <span class="nf">performance_results_by_task_name</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">task_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PerformanceData</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the &#39;perf.json&#39; performance results for a given task_id and task_name.</span>

<span class="sd">        :param task_id: Id of task to query for.</span>
<span class="sd">        :param task_name: Name of task to query for.</span>
<span class="sd">        :return: Contents of &#39;perf.json&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_server</span><span class="si">}</span><span class="s2">/api/2/task/</span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">/json/history/</span><span class="si">{</span><span class="n">task_name</span><span class="si">}</span><span class="s2">/perf&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">PerformanceData</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paginate</span><span class="p">(</span><span class="n">url</span><span class="p">)]</span>  <span class="c1"># type: ignore[arg-type]</span></div>

<div class="viewcode-block" id="EvergreenApi.json_by_task"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.json_by_task">[docs]</a>    <span class="k">def</span> <span class="nf">json_by_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">json_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the json reported for task {task_id} using the key {json_key}.</span>

<span class="sd">        :param task_id: Id of task to query for.</span>
<span class="sd">        :param json_key: The key that json was published under, e.g. &quot;perf&quot;.</span>
<span class="sd">        :return: The json published for that task.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_plugin_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/task/</span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">json_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paginate</span><span class="p">(</span><span class="n">url</span><span class="p">))</span></div>

<div class="viewcode-block" id="EvergreenApi.json_history_for_task"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.json_history_for_task">[docs]</a>    <span class="k">def</span> <span class="nf">json_history_for_task</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">task_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">json_key</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the history of json reported for task {task_id} using the key {json_key}.</span>

<span class="sd">        :param task_id: Id of task to query for.</span>
<span class="sd">        :param task_name: Name of task to query for.</span>
<span class="sd">        :param json_key: The key that json was published under, e.g. &quot;perf&quot;.</span>
<span class="sd">        :return: A chronological list of json published for that task.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_server</span><span class="si">}</span><span class="s2">/api/2/task/</span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">/json/history/</span><span class="si">{</span><span class="n">task_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">json_key</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paginate</span><span class="p">(</span><span class="n">url</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">_create_old_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build a url for an pre-v2 endpoint.</span>

<span class="sd">        :param endpoint: endpoint to build url for.</span>
<span class="sd">        :return: An string pointing to the given endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_api_server</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&quot;</span>

<div class="viewcode-block" id="EvergreenApi.manifest"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.manifest">[docs]</a>    <span class="k">def</span> <span class="nf">manifest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">revision</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Manifest</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the manifest for the given revision.</span>

<span class="sd">        :param project_id: Project the revision belongs to.</span>
<span class="sd">        :param revision: Revision to get manifest of.</span>
<span class="sd">        :return: Manifest of the given revision of the given project.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_old_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;plugin/manifest/get/</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">revision</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Manifest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span> <span class="bp">self</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span></div>

<div class="viewcode-block" id="EvergreenApi.retrieve_task_log"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.retrieve_task_log">[docs]</a>    <span class="k">def</span> <span class="nf">retrieve_task_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the request log file from a task.</span>

<span class="sd">        :param log_url: URL of log to retrieve.</span>
<span class="sd">        :param raw: Retrieve the raw version of the log</span>
<span class="sd">        :return: Contents of specified log file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">log_url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span><span class="o">.</span><span class="n">text</span></div>

<div class="viewcode-block" id="EvergreenApi.stream_log"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.stream_log">[docs]</a>    <span class="k">def</span> <span class="nf">stream_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stream the given log url as a python generator.</span>

<span class="sd">        :param log_url: URL of log file to stream.</span>
<span class="sd">        :return: Iterable for contents of log_url.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream_api</span><span class="p">(</span><span class="n">log_url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></div>

<div class="viewcode-block" id="EvergreenApi.permissions_for_user"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.permissions_for_user">[docs]</a>    <span class="k">def</span> <span class="nf">permissions_for_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ResourceTypePermissions</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the permissions a user has on evergreen resources.</span>

<span class="sd">        :param user_id: Id of the user whose permissions to get.</span>
<span class="sd">        :return: List of permissions the user has.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/users/</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">/permissions&quot;</span><span class="p">)</span>
        <span class="n">raw_permissions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ResourceTypePermissions</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">raw_permissions</span><span class="p">]</span></div>

<div class="viewcode-block" id="EvergreenApi.give_permissions_to_user"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.give_permissions_to_user">[docs]</a>    <span class="k">def</span> <span class="nf">give_permissions_to_user</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">resource_type</span><span class="p">:</span> <span class="n">PermissionableResourceType</span><span class="p">,</span>
        <span class="n">resources</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">permissions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Grant a user permissions to evergreen resources.</span>

<span class="sd">        :param user_id: Id of the user to give permissions to.</span>
<span class="sd">        :param resource_type: An evergreen resource type that supports permissions.</span>
<span class="sd">        :param resources: A list of evergreen resources of type `resource_type`.</span>
<span class="sd">        :param permissions: Permissions to grant.</span>
<span class="sd">                            E.g. - [{&quot;project_tasks&quot;: 30, &quot;project_patches&quot;: 10}]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/users/</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">/permissions&quot;</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;resource_type&quot;</span><span class="p">:</span> <span class="n">resource_type</span><span class="p">,</span>
            <span class="s2">&quot;resources&quot;</span><span class="p">:</span> <span class="n">resources</span><span class="p">,</span>
            <span class="s2">&quot;permissions&quot;</span><span class="p">:</span> <span class="n">permissions</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span></div>

<div class="viewcode-block" id="EvergreenApi.give_roles_to_user"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.give_roles_to_user">[docs]</a>    <span class="k">def</span> <span class="nf">give_roles_to_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">roles</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">create_user</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add the specified role to the specified user.</span>

<span class="sd">        :param user_id: Id of the user to give the roles to.</span>
<span class="sd">        :param roles: A list of roles to give to the user.</span>
<span class="sd">        :param create_user: If true, will also create a user document for the user.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/users/</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">/roles&quot;</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
            <span class="s2">&quot;roles&quot;</span><span class="p">:</span> <span class="n">roles</span><span class="p">,</span>
            <span class="s2">&quot;create_user&quot;</span><span class="p">:</span> <span class="n">create_user</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span></div>

<div class="viewcode-block" id="EvergreenApi.delete_user_permissions"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.delete_user_permissions">[docs]</a>    <span class="k">def</span> <span class="nf">delete_user_permissions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">resource_type</span><span class="p">:</span> <span class="n">RemovablePermission</span><span class="p">,</span> <span class="n">resource_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete all permissions of a given type for a user.</span>

<span class="sd">        :param user_id: Id of the user whose permissions to remove.</span>
<span class="sd">        :param resource_type: A permission that can be removed.</span>
<span class="sd">        :param resource_id: Resource id for which to delete permissions. Required unless</span>
<span class="sd">                            deleting all permissions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/users/</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">/permissions&quot;</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;resource_type&quot;</span><span class="p">:</span> <span class="n">resource_type</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">resource_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;resource_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resource_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;DELETE&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span></div>

<div class="viewcode-block" id="EvergreenApi.get_users_for_role"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.get_users_for_role">[docs]</a>    <span class="k">def</span> <span class="nf">get_users_for_role</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UsersForRole</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of users having an evergreen role.</span>

<span class="sd">        :param role: Role to fetch users for.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/roles/</span><span class="si">{</span><span class="n">role</span><span class="si">}</span><span class="s2">/users&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">UsersForRole</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span> <span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="EvergreenApi.all_user_permissions_for_resource"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.all_user_permissions_for_resource">[docs]</a>    <span class="k">def</span> <span class="nf">all_user_permissions_for_resource</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">resource_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">resource_type</span><span class="p">:</span> <span class="n">PermissionableResourceType</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all users with their permissions to the resource.</span>

<span class="sd">        The returned dict has the following structure -</span>

<span class="sd">        .. code-block:: json</span>

<span class="sd">            {</span>
<span class="sd">              &quot;username_1&quot;: {</span>
<span class="sd">                 &quot;project_tasks&quot;: 30,</span>
<span class="sd">                 &quot;project_patches&quot;: 10</span>
<span class="sd">                },</span>
<span class="sd">              &quot;username_2&quot;: {</span>
<span class="sd">                 &quot;project_settings&quot;: 20,</span>
<span class="sd">                 &quot;project_patches&quot;: 10</span>
<span class="sd">              }</span>
<span class="sd">            }</span>

<span class="sd">        :param resource_id: Id of the resource to get users for.</span>
<span class="sd">        :param resource_type: Resource type of the resource.</span>
<span class="sd">        :return: A dict containing user to permissions mappings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="s2">&quot;/users/permissions&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;resource_id&quot;</span><span class="p">:</span> <span class="n">resource_id</span><span class="p">,</span> <span class="s2">&quot;resource_type&quot;</span><span class="p">:</span> <span class="n">resource_type</span><span class="p">})</span>
        <span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span></div>

<div class="viewcode-block" id="EvergreenApi.select_tests"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.select_tests">[docs]</a>    <span class="k">def</span> <span class="nf">select_tests</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">build_variant</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">requester</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">task_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">tests</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a subset of tests to run for a given task.</span>

<span class="sd">        :param project_id: project identifier of running task.</span>
<span class="sd">        :param build_variant: build variant of running task.</span>
<span class="sd">        :param requester: requester of running task.</span>
<span class="sd">        :param task_id: task_id of running task.</span>
<span class="sd">        :param task_name: task_name of running task.</span>
<span class="sd">        :param tests: list of tests to filter.</span>
<span class="sd">        :return: A dict containing all of the given information with a filtered list of tests.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_url</span><span class="p">(</span><span class="s2">&quot;/select/tests&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;project&quot;</span><span class="p">:</span> <span class="n">project_id</span><span class="p">,</span>
            <span class="s2">&quot;build_variant&quot;</span><span class="p">:</span> <span class="n">build_variant</span><span class="p">,</span>
            <span class="s2">&quot;requester&quot;</span><span class="p">:</span> <span class="n">requester</span><span class="p">,</span>
            <span class="s2">&quot;task_id&quot;</span><span class="p">:</span> <span class="n">task_id</span><span class="p">,</span>
            <span class="s2">&quot;task_name&quot;</span><span class="p">:</span> <span class="n">task_name</span><span class="p">,</span>
            <span class="s2">&quot;tests&quot;</span><span class="p">:</span> <span class="n">tests</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_api</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="o">.</span><span class="n">json</span><span class="p">()</span></div>

<div class="viewcode-block" id="EvergreenApi.get_api"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.EvergreenApi.get_api">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_api</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">auth</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EvgAuth</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_config_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">config_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_NETWORK_TIMEOUT_SEC</span><span class="p">,</span>
        <span class="n">log_on_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;EvergreenApi&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an evergreen api instance based on config file settings.</span>

<span class="sd">        :param auth: EvgAuth with authentication to use.</span>
<span class="sd">        :param use_config_file: attempt to read auth from default config file.</span>
<span class="sd">        :param config_file: config file with authentication information.</span>
<span class="sd">        :param timeout: Network timeout.</span>
<span class="sd">        :return: EvergreenApi instance.</span>
<span class="sd">        :param log_on_error: Flag to use for error logs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">EvergreenApi</span><span class="o">.</span><span class="n">_setup_kwargs</span><span class="p">(</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
            <span class="n">auth</span><span class="o">=</span><span class="n">auth</span><span class="p">,</span>
            <span class="n">use_config_file</span><span class="o">=</span><span class="n">use_config_file</span><span class="p">,</span>
            <span class="n">config_file</span><span class="o">=</span><span class="n">config_file</span><span class="p">,</span>
            <span class="n">log_on_error</span><span class="o">=</span><span class="n">log_on_error</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_setup_kwargs</span><span class="p">(</span>
        <span class="n">auth</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EvgAuth</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_config_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">config_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_NETWORK_TIMEOUT_SEC</span><span class="p">,</span>
        <span class="n">log_on_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;auth&quot;</span><span class="p">:</span> <span class="n">auth</span><span class="p">,</span> <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="n">timeout</span><span class="p">,</span> <span class="s2">&quot;log_on_error&quot;</span><span class="p">:</span> <span class="n">log_on_error</span><span class="p">}</span>
        <span class="n">config</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">use_config_file</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">read_evergreen_config</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;The Evergreen config file cannot be found.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">config_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">read_evergreen_from_file</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">auth</span> <span class="o">=</span> <span class="n">get_auth_from_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">auth</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;auth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">auth</span>

            <span class="c1"># If there is a value for api_server_host, then use it.</span>
            <span class="k">if</span> <span class="s2">&quot;evergreen&quot;</span> <span class="ow">in</span> <span class="n">config</span> <span class="ow">and</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;evergreen&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_server_host&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;api_server&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;evergreen&quot;</span><span class="p">][</span><span class="s2">&quot;api_server_host&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">kwargs</span></div>


<div class="viewcode-block" id="CachedEvergreenApi"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.CachedEvergreenApi">[docs]</a><span class="k">class</span> <span class="nc">CachedEvergreenApi</span><span class="p">(</span><span class="n">EvergreenApi</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Access to the Evergreen API server that caches certain calls.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">api_server</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_API_SERVER</span><span class="p">,</span>
        <span class="n">auth</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EvgAuth</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">log_on_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an Evergreen Api object.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CachedEvergreenApi</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">api_server</span><span class="p">,</span> <span class="n">auth</span><span class="p">,</span> <span class="n">timeout</span><span class="p">,</span> <span class="n">log_on_error</span><span class="o">=</span><span class="n">log_on_error</span>
        <span class="p">)</span>

<div class="viewcode-block" id="CachedEvergreenApi.build_by_id"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.CachedEvergreenApi.build_by_id">[docs]</a>    <span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="n">CACHE_SIZE</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">build_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">build_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Build</span><span class="p">:</span>  <span class="c1"># type: ignore[override]</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a build by id.</span>

<span class="sd">        :param build_id: build id to query.</span>
<span class="sd">        :return: Build queried for.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">CachedEvergreenApi</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">build_by_id</span><span class="p">(</span><span class="n">build_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="CachedEvergreenApi.version_by_id"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.CachedEvergreenApi.version_by_id">[docs]</a>    <span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="n">CACHE_SIZE</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">version_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Version</span><span class="p">:</span>  <span class="c1"># type: ignore[override]</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get version by version id.</span>

<span class="sd">        :param version_id: Id of version to query.</span>
<span class="sd">        :return: Version queried for.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">CachedEvergreenApi</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">version_by_id</span><span class="p">(</span><span class="n">version_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="CachedEvergreenApi.tasks_by_build"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.CachedEvergreenApi.tasks_by_build">[docs]</a>    <span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="n">CACHE_SIZE</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">tasks_by_build</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">build_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fetch_all_executions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Task</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get tasks by build.</span>

<span class="sd">        :param build_id: Id of build to query.</span>
<span class="sd">        :param fetch_all_executions: should fetch all executions of the tasks</span>
<span class="sd">        :return: List of the queried tasks.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">CachedEvergreenApi</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">tasks_by_build</span><span class="p">(</span>
            <span class="n">build_id</span><span class="o">=</span><span class="n">build_id</span><span class="p">,</span> <span class="n">fetch_all_executions</span><span class="o">=</span><span class="n">fetch_all_executions</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="CachedEvergreenApi.clear_caches"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.CachedEvergreenApi.clear_caches">[docs]</a>    <span class="k">def</span> <span class="nf">clear_caches</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear the cache.&quot;&quot;&quot;</span>
        <span class="n">cached_functions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_by_id</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">version_by_id</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tasks_by_build</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">cached_functions</span><span class="p">:</span>
            <span class="n">fn</span><span class="o">.</span><span class="n">cache_clear</span><span class="p">()</span>  <span class="c1"># type: ignore[attr-defined]</span></div></div>


<div class="viewcode-block" id="RetryingEvergreenApi"><a class="viewcode-back" href="../../evergreen.html#evergreen.api.RetryingEvergreenApi">[docs]</a><span class="k">class</span> <span class="nc">RetryingEvergreenApi</span><span class="p">(</span><span class="n">EvergreenApi</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An Evergreen Api that retries failed calls.&quot;&quot;&quot;</span>

    <span class="n">DEFAULT_HTTP_RETRY</span> <span class="o">=</span> <span class="n">Retry</span><span class="p">(</span>
        <span class="n">total</span><span class="o">=</span><span class="n">DEFAULT_HTTP_RETRY_ATTEMPTS</span><span class="p">,</span>
        <span class="n">backoff_factor</span><span class="o">=</span><span class="n">DEFAULT_HTTP_RETRY_BACKOFF_FACTOR</span><span class="p">,</span>
        <span class="n">backoff_max</span><span class="o">=</span><span class="n">DEFAULT_HTTP_RETRY_BACKOFF_MAX_SEC</span><span class="p">,</span>
        <span class="n">status_forcelist</span><span class="o">=</span><span class="n">DEFAULT_HTTP_RETRY_CODES</span><span class="p">,</span>
        <span class="n">raise_on_status</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">raise_on_redirect</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">api_server</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_API_SERVER</span><span class="p">,</span>
        <span class="n">auth</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EvgAuth</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">log_on_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">use_default_logger_factory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">http_retry</span><span class="p">:</span> <span class="n">Retry</span> <span class="o">=</span> <span class="n">DEFAULT_HTTP_RETRY</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an Evergreen Api object.&quot;&quot;&quot;</span>
        <span class="n">sticky_session_with_retry</span> <span class="o">=</span> <span class="n">EvergreenApi</span><span class="p">(</span>
            <span class="n">api_server</span><span class="p">,</span>
            <span class="n">auth</span><span class="p">,</span>
            <span class="n">timeout</span><span class="p">,</span>
            <span class="n">log_on_error</span><span class="o">=</span><span class="n">log_on_error</span><span class="p">,</span>
            <span class="n">use_default_logger_factory</span><span class="o">=</span><span class="n">use_default_logger_factory</span><span class="p">,</span>
            <span class="n">http_retry</span><span class="o">=</span><span class="n">http_retry</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">_create_session</span><span class="p">()</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">RetryingEvergreenApi</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">api_server</span><span class="p">,</span>
            <span class="n">auth</span><span class="p">,</span>
            <span class="n">timeout</span><span class="p">,</span>
            <span class="n">sticky_session_with_retry</span><span class="p">,</span>
            <span class="n">log_on_error</span><span class="p">,</span>
            <span class="n">use_default_logger_factory</span><span class="p">,</span>
            <span class="n">http_retry</span><span class="p">,</span>
        <span class="p">)</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation index</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
    &copy; Copyright 2020 MongoDB.
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.
  </div>
  
  </body>
</html>